Linux基础
====

讲一下grep,正则,管道等用法

03 bash使用
----

*   想查看日历可以使用cal命令。默认显示本月日历，也可以后跟年份，显示全年日历。

    >       cal 2017

    date命令则可以查看当前日期。

    可以自己练习使用man或info查看cal和date命令的说明。

*   在虚拟终端中也可以使用鼠标，辅助选中复制粘贴文本或者在虚拟终端用鼠标滚轮翻页。鼠标左键拖动选中（不同于Windows，选中的同时就复制了），鼠标中间粘贴。另外Ctrl+C和Ctrl+V是Windows下的复制粘贴快捷键，在Linux下有其它用途。

*   使用sh命令也可以打开一个命令行shell。但是，在Ubuntu系统中，sh指令默认并不是绑定到bash，而是另一款叫做dash的shell。dash和bash大同小异，一般来说dash更加精简，并且更多地用于执行命令行脚本（以后会介绍到命令行脚本）。

04 busybox
----
*   之前使用的cal和date就是busybox集成的。

*   busybox的命令可以直接输命令名，也可以输入busybox后跟参数：

    >       cal

    >       busybox cal

*   清空屏幕clear

*   一直输出y，yes命令（用Ctrl+C终止或者使用Ctrl+Z挂起，以后在介绍进程的时候有用。）

    >       yes

*   原样输出一行字符，echo

    >       echo Hello World !

    效果就是喜闻乐见的HelloWorld。

05 文件与目录（上）
----

*   Linux中把一切都看作文件。

    *   设备、文件夹、快捷方式等都被当作特殊文件处理。例如访问一个设备，在Linux系统中就是访问了一个特殊文件而已。

*   任何文件的本质都是二进制序列。因此一切文件都可以作为ASCII文本打开。

    *   有的文件按ASCII文本打开后很难直接看出其它是什么有意义的文本。这也就是所谓的“乱码”。

*   操作系统中用于文件管理的部分称为文件系统。操作系统不一定仅仅能支持一种文件系统。例如比较老版本的Windows上经常能见到NTFS和FAT32共存。Linux下，ext2，ext3，ext4这一系列文件系统比较常见。

*   类似于Windows，Linux中实用树形结构管理文件。

    *   有时候我也把“文件夹”叫做目录。“在当前文件夹下”也称作“在当前目录下”。

    *   在Linux中“C”，“D”之类的盘符没有Windows那么重要。最顶层的文件目录不是各个硬盘分区，而是一个被称为根目录的地方，一些看可有可无的硬盘分区挂载在根目录下的特定文件夹中。

*   file用于查看文件类型。

    *   Linux下后缀名不是必须的。也不决定文件类型。

06 文件与目录（中）
----

*   以上命令都可以配合通配符使用。

    *   通配符是在字符串处理时用的一种约定。由于文件名都是字符串，因此检索和表示文件名的时候可以使用通配符。

    *   关于bash所支持的通配符写法，详见man bash。这里仅仅介绍两个简单且常见的通配符。

    *   \*表示任意个相连的任意字符。例如任何以".txt"结尾的文件名表示为

        >       *.txt

        任意一个文件名表示为

        >       *

    *   \?表示一个任意字符，如以“a”开头，以“b”结尾，中间夹一个字符的文件名。

        >       a?b

08 文本编辑
----

*   想要查看一个文本文件可以使用less（或者more）命令。less后接文件名。和man类似。使用空格和b翻页，q退出。

*   如果是熟悉MS-DOS的记事本的用户推荐使用nano。如果喜欢一个功能强大的集成编辑器推荐Emacs /ˈiːmæks/。

*   当然，并非所有人都需要熟练掌握学习曲线非常陡峭的vi/vim。如果不需要经常在没有图形化界面帮助的命令行模式下写代码，完全可以使用atom或者vscode。

*   Linux系统当中的很多配置和设置（或者软件的设置）都是通过修改文本配置文件完成的。但是这里不进行详述。

*   也可以通过一些赋值命令直接修改系统环境变量。但是同样不在这里详述。

09 获取root
----

*   Linux是一个多用户系统。它允许不同用户公用同一套软硬件同时保持他们各自的程序和文件相对独立。如果你对于多用户操作系统没有概念，就把Linux上的用户管理理解成QQ群的管理。

    *   一个群里可以有很多QQ号，但是没有必要人手一个，有的人可以注册多个QQ号。类似的，Linux系统上的用户数不一定等于实际适用这台计算机的人数。（当然可以一个人注册一堆用户身份玩。）

    *   QQ群里有管理员负责拉人、踢人、禁言等。类似的Linux系统上有特权用户，可以控制其他用户的所有文件和权限。一般而言Linux系统中默认只有一个超级用户名叫root。

    *   为了方便管理，Linux给用户分了组，这样就能批量地给用户授权。比如给所有A组成员发言权利，但是把B组都禁言。

*   Ubuntu关于root权限获取的特殊说明：Ubuntu在安装过程中不会要求设置root用户的密码。在安装完成后root用户的专用home文件夹也是不可用状态。此时我们只能使用安装时设置的普通用户身份登陆。但是这个最初的普通身份可以通过sudo命令获得超级用户的所有权限，包括设置超级用户的密码。

*   在第一次以root身份登陆之前需要先设置root的密码

    >sudo passwd root

    在这行命令之后输入密码回车确认，然后再输入一次再回车。注意Linux下默认不论设置密码还是输入密码都不会在屏幕上现实。所以如果按字母键后发现屏幕上没有显示，不是按键没有响应。

*   不同的用户对于文件和程序有不同的权限。在Linux下可能需要频繁切换用户。在Windows下切换用户需要注销后重新登陆。这在Linux下当然也可以，但是有更为简便的方法。su命令后接用户名就会以这个用户名所对应的身份打开一个新的shell（原来的shell还没关闭）。

    *   注意普通用户的提示符为$，超级用户提示符为#。

    *   sudo可以以另一个用户的身份执行一条命令（而不打开一个新shell）。

*   查看用户的身份标识使用id命令。


10 文件权限
----

*   文件访问权限说明（ls -l）。

    *   第1位文件类型：

        \- 文件

        d 目录

        l 符号链接

        c 字符设备

        b 块设备

        linux中设备也是文件。

    *   2，3，4一组；5，6，7一组；8，9，10一组。分别表示

        所有者权限：文件所有者对文件的权限

        组权限：所有者所在组其他用户对此文件的权限

        其他用户权限：不和所有者在一组的其他用户对此文件的权限

        （不论如何，超级用户拥有所有权限）。

        每组中的
        
        第1位表示读权限

        第2位表示写权限

        第3位表示可执行文件的执行权限

        （rwx）

        字母表示有权限，对应位置是“-”表示无权限。

*   chmod命令用于修改文件访问权限。它接受两个参数：

    *   第一个参数是三位八进制数，用于表示要修改到的文件访问权限状态。

    *   第二个参数是要修改的文件。

    *   三位八进制数每一位对应三组权限中的一组。读，写，执行分别对应4，2，1。有这个权限就把数字加上，没有这个权限就记0。例如1表示仅有执行权，5表示执行权和读权，7表示三个权限都有。

*   umask可以设置新建文件默认访问权限，在此不做详细说明。

*   chown可以修改文件所有者和所属组群。在此不做详细介绍。

11 用户管理
----

*   之前介绍的《Linux命令行大全》中并没有介绍这一部分内容。推荐一本新的参考书布卢姆的《Linux命令行与脚本编程大全》。

*   用户密码信息保存在/etc/shadow

*   用户管理一般要使用root身份或sudo命令。

*   创建新用户使用命令useradd后加参数新用户名。

*   创建用户的时候没有同步设置其密码，需要使用passwd命令为其设置密码。（如果要修改自己的密码，不需要sudo也可以设置。）

*   删除用户用userdel。

*   还有更多命令，例如读取密码，修改密码过期时间或者限制用户登陆。但是在此不做详细介绍。

*   用户组信息保存在/etc/group

*   新建组用groupadd命令。删除用groupdel命令。

*   把一个用户移动到某个组使用usermod命令。

*   修改组本身信息使用groupmod命令。

- - - -

12 理论补充
---- 

1. 操作系统的作用，最主要的有以下几点：

    * 存储器管理：不论内存还是外存，操作系统需要合理安排存储器的使用，提高空间利用效率。
    
    * 文件管理：在存储器管理，尤其是外部存储器管理的基础上，需要给数据建立更高级的结构。这就是文件系统。文件管理就是指用以管理文件的文件系统。同时对于多个运行中的程序而言，文件可能是一种维持程序运行需要的资源。

    * 设备管理：操作系统需要控制所有I/O设备，并为用户提供调用设备的接口。对于多个运行中的程序而言，设备也是一种维持程序运行的资源。操作系统需要合理分配设备给不同的程序。

    * 进程管理：又称为处理器管理。其实和存储器管理，设备管理一样，它最终的管理对象是硬件设备。它对计算机体系中的处理机（也就是CPU，或者说运算器和控制器）进行管理。但是由于这种管理中调度的基本单位就是进程，所以一般称为进程管理。

    * 上述几种作用是作为一个操作系统最低限的功能。现在而言，对于操作系统有了更多的要求，例如多用户、安全性、多媒体、网络功能等等。用于不同场景的操作系统可能要求也不尽相同。

2. 关于进程

    * 我们都知道什么是“程序”。而进程就是执行中的程序。在Windows上启动三个腾讯QQ，虽然QQ的程序代码只有一份，但是由于同时有三个QQ号登陆，因此有三个腾讯QQ进程。

    * 进程的准确定义其实现在还有争议。简单点说，一个程序执行一次就是一个进程。对于很古老的一次只能执行一个任务的操作系统，它同时只能维持一个进程。因此所谓“进程管理”毫无意义。而现在所能见到的操作系统一般都是“多道”的（也就是说可以同时维持或执行多个进程），可能同时有多个进程，这时“进程管理”才是一个有实际意义的话题。

    * 实现进程同步执行（或推进）有两种思路。区别在于对“同步”的理解不一致。

        + 如果两个进程齐头并进，对于每一个机器周期都是有两条分属于两个进程的指令在同时执行，就称为并行。实现这种“同步”，就需要硬件事实上有多个处理机。
        
        + 如果每一个机器周期只有一条指令在执行，但是在操作系统的控制下两个进程来回切换，一会推进这个进程一会推进另一个，整体上看两个进程推进的平均速度差不多，就属于并发。即使只有一个处理机，也能通过进程的切换实现并发。

    * 进程有三种基本状态：就绪，执行，阻塞。外加创造进程时的开始和完成进程后的结束，一共五种状态。而进程管理就是根据各个进程的执行状况和现在的资源情况让进程们在这几种状态之间来回切换。为了调度方便，一般还增加一种挂起状态（其实是两种状态——静止阻塞，静止就绪）。
    
3. 进程调度中的问题

    进程调度需要解决的主要是资源分配的问题。如果不把时间当成一种特殊资源的话，实时性也是一类特殊问题。这些问题是操作系统原理中的重头戏，但是由于我们不需要实现操作系统，所以这里只简要提一下死锁问题。

    * 死锁是资源分配中的问题。它是指虽然计算机整体资源足够，但是由于进程推进顺序不当等问题造成资源分配不合理，最终导致进程陷入僵局无法继续推进。

    * 举个最简单的例子：有两根筷子1号和2号（象征资源）。另有两个人A和B要吃饭（象征进程）。必须拿到全部筷子才能吃饭。例如A先拿到两根筷子，吃完再吧筷子给B，B也吃完。俩人的饭都吃完了。但是如果两个人各拿到一根筷子，还都不肯把自己的筷子给对方，这就会无限等下去，最后谁都吃不了饭。

    * 死锁问题的处理十分复杂。教科书上分为预防、避免、检测、解除四类问题。但是尽管有很多算法试图解决死锁问题，现实中死锁还是免不了时常出现。对于实在没有其他更好办法解决的死锁，最后的手段就是重启系统。

4. 关于存储器管理

    * 文件结构和存储器管理中经常用到的单位“段页”并不是一回事。

    * 计算机最底层的存储单位是二进制位。为了方便起见，绝大多数计算机都把8个位打包成1个字节，以字节作为不可再分的存储单位。

    * 为了存储器管理方便，操作系统把存储空间划分为若干连续且大小相等的“页”。（实际上就是又把很多字节打包成了一个更大的单位。）并且以页作为基本的调度单位。在给进程分配内存或者给文件划分存储空间的时候，不能划给小于1页的空间。所以有时候会出现文件所占的空间比文件实际大小大的情况。
    
    * 段与页类似，但是也有很多不同。在此不做详细介绍。

5. 关于虚拟内存

    * 内存，外存在速度和容量两个方面各有所长。
    
    * 存储器管理的一个任务就是协调各级存储器，获得尽量大的速度和容量。

    * 一个方法就是虚拟内存。虚拟内存就是指在外存上划分一块专门区域，把内存中暂时用不到的信息交换到外存，需要时再交换会来。这样虽然物理内存没有变大，但是对于程序来说好像内存空间变大了。

    * 由于终究没有增加物理内存，因此整体上虚拟内存牺牲了一点访问速度换取了更大的空间。一般而言1G虚拟内存的速度要比纯粹的1G内存慢，但是比直接访问硬盘快。

- - - -

13 进程与内存
----

1. 内存状态查看

    没有直接的命令查看当前内存情况。Linux提供了一个文件用以映射当前内存实况。访问这个文件就能获得当前的内存信息。因此使用以下命令就能查看内存状态。

    >more /proc/meminfo

2. 目前的操作系统绝大多数都提供了并发性。要想查看当前Linux系统正在运行的进程信息，可以使用ps命令。其中的PID是系统内部用于识别不同进程的编号。

3. Linux中可以使用Ctrl+S挂起程序，用Ctrl+Q解除挂起。

4. 要想让当前在前台执行的程序暂停，返回命令行。则使用Ctrl+Z快捷键。如果要从命令行返回执行则使用fg命令。

5. 要想从命令行终止进程则使用kill命令加要终止的进程的PID。（前提是你拥有终止该进程的权限。）例如：

    >kill 1810

    但是有的程序有时会忽视这个请求。所以还需要加额外参数：

    >kill -s KILL 1810

    其中参数`-s`表示要向进程发送信息，`KILL`是要发送的信息，意在让进程立即终止。

6. 进程之间的通信是可以通过一种名为“管道”的方式。

    在shell中使用管道符`|`来表示管道。简单来说在这个符号后边的程序以前边程序的输出为输入。例如用less查看ls命令的输出：

    >ls | less

7.  重定性操作符可以完成和管道类似的功能。重定向操作符有`>`,`<`等。

    >ls > lsout.txt

    表示新建一个文件`lsout.txt`,并把ls命令执行结果保存进去。

    >cat < lsout.txt

    表示将`lsout.txt`作为cat命令的输入（cat命令本来是从标准输入读入一行然后在显示器上显示一行）。

- - - -

14 设备挂载、文件相关
----

1. 之前所介绍的Linux文件系统主目录其实是一个虚拟目录。其地位有点类似于Windows中的我的电脑。每当有新的设备链接到系统，相应的访问接口就应该被映射到这个虚拟目录下。这个过程称之为挂载。

2. 查看当前系统中挂载的存储器信息使用mount命令。

3. 目前Linux系统可以对很多常用存储器实现自动挂载（简单理解为CD或者U盘之类的插上就能用）。因此如果有需要手动挂载的情况，请参考mount命令的手册和说明信息。

4. 设备在使用后应当先卸载再移除硬件连接。类似Windows上U盘用完后需要先安全删除再拔掉。卸载存储器使用unmount命令，例如：

    >umount /media/tomx/TOM_X

    命令的参数是设备挂载后的地址。

    其实现在这一操作也可以在图形化界面下完成。

5. 查看磁盘空间使用情况用df命令。du命令则可以查看指定目录下磁盘使用情况（其显示的数据的单位是磁盘块）。

6. 其他设备有类似的处理方式。总之在Linux系统中一切设备都被当作文件处理。

7. 对存储器进行分区需要使用fdisk命令。创建文件系统需要使用mkfs命令。由于新手可能一般不常用这两个命令所以不做介绍。有使用需要可以自行查看说明。

8. 如果需要搜索文件，请查看locate或find的说明。

    示例：

    >locate fiction

    其中`fiction`是文件名。

    同样类似功能也有对应的图形化界面版本，如果是日常使用可以使用搜索框直接搜索。

9. Linux系统发行版中一般还包含了大量文本处理工具。例如标准输入复述命令cat，文本排序命令sort，逐行比较命令diff，拼写差错命令aspell等。但是由于个人更习惯使用专用的文本编辑器，所以对于此类工具在此不做更多介绍。

- - - -

15 拾遗
----

6. apropos和可以搜索与给定词有关的命令。例如：

    >apropos floppy

7. whatis命令可以显示命令的概述。例如：

    >whatis ls

8. 在本系列和以后的相关系列中，我都以“点到为止”的思路做视频。因为Linux相关的内容极多，不可能面面俱到。而且更为关键的是作为一个视频教程不需要面面俱到。Linux发展这么多年来，几乎每一款常用命令都自带详尽的说明。再加上现在互联网普及，通过搜索引擎、论坛、官网等都能轻易获得相关文档。与其看我这个让人想睡觉的视频不如多花时间学学如何搜索到自己需要的信息。

    我所做的视频，旨在点到重要和常用的内容。对于新手来说，避免直接一头扎入看不完的文档中，省却一些寻找学习方向的时间。

9. 关于后续

    本系列视频只是我计划中的Linux与C专题中的一部分。仅仅介绍了Bash最为基本的指令。诸如Linux上常用的压缩工具、包管理工具、网络工具、版本控制工具等偏应用的内容将在以后以小专题形式制作。

    除了应用向教程，shell脚本编程、C语言开发环境、C语言基础、C语言Linux编程、Lua与C等也会作为专题出现。





# 02 进程管理工具
## 进程标识
1. 进程管理主要是查看、终止、挂起和继续进程。本期主要介绍bash内置的进程管理命令。
2. 进程在操作系统中由PID（Process ID）标识。
3. 在使用bash的进程管理时，还会给每个可以管理的进程分配一个工作号（job number）。
4. 使用jobs命令查看进程的信息。后加参数`-l`显示详细信息。例如：
    >```
    >[1]+  2630 Running                 xlogo &
    >```
    其中方括号内的1是工作号，2630是进程号。Running是执行状况。xlogo是进程名（xlogo是一个简单的用于显示一个小窗口的程序）。&符表示程序后台运行。
## 进程控制快捷键
1. 直观地理解，一个程序在前台运行就会用它的界面覆盖bash的命令行界面（例如正常启动的vim）。而后台运行的程序不会这样。但是注意后台运行的程序其实也可以通过调用输入输出流把文字输出到终端（例如后台运行的yes）。
2. 进程控制快捷键可以在无法向bash输入命令时控制进程。但是只对前台进程有效。另外这组快捷键并非由bash定义，而是由终端驱动解析，可以通过stty命令查看或修改（`stty -a`查看所有快捷键）。
    * C-z 暂停当前进程，并把控制权交还bash。
    * C-y 延迟暂停进程，当进程试图读取输入流时暂停进程并把控制权交还bash。
    * C-s 暂停当前进程，但不交还控制权给bash。
    * C-q 使用C-s暂停进程后使用C-q继续进程。
    * C-c 终止当前进程，返回bash。
3. 这些快捷键的本质是向当前前台进程发送信号。例如C-c发送SIGINT信号，C-z发送SIGTSTP信号。
## 信号机制
1. kill命令用于终止指定进程。例如`kill 2630`。一个比较常用的选项是`-9`，用于强制终止指定进程。例如`kill -9 2630`。
2. 指定进程有多种方法：
    * 之前例子中，kill后的2630是程序PID。
    * 也可以用工作号指定。但是工作号之前需要加百分号%。
    * `%+`和`%-`可以用于最近后台启动或暂停过的进程。具体指那个进程，可以通过jobs列表中工作号后的加减号辨别。
        + 带加号的被称为默认作业。带减号的是下一个默认作业。默认作业完成后下一个默认作业成为默认作业。
    * %后接进程名的部分拼写也可以指进程。这其中还可以用一些正则表达式规则。
3. 为了进一步说明kill命令先介绍一个suspend命令。如果执行这个命令的shell不是一开登录打开的shell，那么就会暂停当前shell。只有接收到SIGCONT信号时才会继续运行。
4. 严格来说kill命令不仅仅用于终止进程。它的完整功能是给指定进程传送信号。kill所支持的信号可以通过`kill -l`查看。可以做一个实验，打开两个虚拟终端，假设其中一个的bash的PID是2619（可以用ps、htop等工具查看）。在2619上运行suspend命令暂停bash。然后在另一个终端执行`kill -18 2619`就可以继续被暂停的bash。（SIGCONT对应数字18。）
## 其他进程调度操作
1. 在输入命令时如果后接&则会后台运行。例如`xlogo &`。
2. fg后接进程，将指定进程调至前台运行。
3. bg后接进程，将指定进程调指后台运行。
4. wait后接子进程。执行wait命令时bash将等待，当指定子进程结束后返回bash。
5. disown后接子进程。当bash退出时不会连带用disown指定的子进程一起退出。由于原有父进程终止，这个子进程将被挂到bash的父进程上。
6. 为以后介绍nohup做个铺垫。disown虽然和nohup看起来效果类似，但是对输入输出流的处理不一样。disown的进程默认情况下输出流仍然和Shell一致。而nohup一般会关闭进程输入流，并且把输出流定向到它指定的文件。
